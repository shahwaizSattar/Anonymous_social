# One-Time Post Feature - Architecture Diagram

## System Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         FRONTEND                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           CreatePostScreen.tsx                            โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  [Toggle] Enable One-Time View                     โ  โ  โ
โ  โ  โ  State: oneTimePost (boolean)                      โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ                        โ                                  โ  โ
โ  โ  POST /api/posts { oneTime: { enabled: true } }          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           HomeScreen.tsx                                  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  {post.oneTime?.enabled ? (                        โ  โ  โ
โ  โ  โ    <OneTimePostCard post={post} />                 โ  โ  โ
โ  โ  โ  ) : (                                             โ  โ  โ
โ  โ  โ    <NormalPostCard post={post} />                  โ  โ  โ
โ  โ  โ  )}                                                โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           OneTimePostCard.tsx                             โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ  โ
โ  โ  โ  โ  Blurred Media (blurRadius: 25)              โ  โ  โ  โ
โ  โ  โ  โ  [Button] ๐๏ธ Tap to Reveal                   โ  โ  โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ  โ
โ  โ  โ  โ  ParticleNoiseReveal Component               โ  โ  โ  โ
โ  โ  โ  โ  - 80 animated particles                     โ  โ  โ  โ
โ  โ  โ  โ  - Jittering motion                          โ  โ  โ  โ
โ  โ  โ  โ  - [Hint] ๐ Tap to reveal                   โ  โ  โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ  โ
โ  โ  โ                    โ (on tap)                      โ  โ  โ
โ  โ  โ  handleReveal() โ POST /api/posts/:id/mark-viewed โ  โ  โ
โ  โ  โ                    โ                               โ  โ  โ
โ  โ  โ  - Fade out blur (1s animation)                    โ  โ  โ
โ  โ  โ  - Dissolve particles (1s animation)               โ  โ  โ
โ  โ  โ  - Show toast notification                         โ  โ  โ
โ  โ  โ  - Set revealed = true                             โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           api.ts                                          โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  markOneTimeViewed(postId)                         โ  โ  โ
โ  โ  โ  โ POST /api/posts/:postId/mark-viewed            โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ HTTP/REST API
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         BACKEND                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           routes/posts.js                                 โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  POST /api/posts                                   โ  โ  โ
โ  โ  โ  - Extract oneTime from req.body                   โ  โ  โ
โ  โ  โ  - Create post with oneTime field                  โ  โ  โ
โ  โ  โ  - Save to MongoDB                                 โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  GET /api/posts/feed                               โ  โ  โ
โ  โ  โ  - Filter: $nor: [                                 โ  โ  โ
โ  โ  โ      { oneTime.enabled: true,                      โ  โ  โ
โ  โ  โ        oneTime.viewedBy: userId }                  โ  โ  โ
โ  โ  โ    ]                                               โ  โ  โ
โ  โ  โ  - Returns posts user hasn't viewed                โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  POST /api/posts/:postId/mark-viewed               โ  โ  โ
โ  โ  โ  - Find post by ID                                 โ  โ  โ
โ  โ  โ  - Check oneTime.enabled                           โ  โ  โ
โ  โ  โ  - Add userId to oneTime.viewedBy array            โ  โ  โ
โ  โ  โ  - Save post                                       โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ Mongoose ODM
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         DATABASE                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           MongoDB - posts collection                      โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ  โ  {                                                 โ  โ  โ
โ  โ  โ    _id: ObjectId,                                  โ  โ  โ
โ  โ  โ    author: ObjectId,                               โ  โ  โ
โ  โ  โ    content: {                                      โ  โ  โ
โ  โ  โ      text: String,                                 โ  โ  โ
โ  โ  โ      media: [{ url, type, ... }]                   โ  โ  โ
โ  โ  โ    },                                              โ  โ  โ
โ  โ  โ    oneTime: {                                      โ  โ  โ
โ  โ  โ      enabled: Boolean,                             โ  โ  โ
โ  โ  โ      viewedBy: [ObjectId, ObjectId, ...]          โ  โ  โ
โ  โ  โ    },                                              โ  โ  โ
โ  โ  โ    // ... other fields                            โ  โ  โ
โ  โ  โ  }                                                 โ  โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Data Flow Diagram

### Creating a One-Time Post

```
User A                CreatePostScreen           Backend              MongoDB
  โ                         โ                       โ                    โ
  โ  1. Toggle ON           โ                       โ                    โ
  โโโโโโโโโโโโโโโโโโโโโโโโโ>โ                       โ                    โ
  โ                         โ                       โ                    โ
  โ  2. Tap "Post"          โ                       โ                    โ
  โโโโโโโโโโโโโโโโโโโโโโโโโ>โ                       โ                    โ
  โ                         โ  3. POST /api/posts   โ                    โ
  โ                         โ  { oneTime: {         โ                    โ
  โ                         โ    enabled: true      โ                    โ
  โ                         โ  }}                   โ                    โ
  โ                         โโโโโโโโโโโโโโโโโโโโโโโ>โ                    โ
  โ                         โ                       โ  4. Insert doc     โ
  โ                         โ                       โ  with oneTime      โ
  โ                         โ                       โโโโโโโโโโโโโโโโโโโโ>โ
  โ                         โ                       โ                    โ
  โ                         โ  5. Success response  โ                    โ
  โ                         โ<โโโโโโโโโโโโโโโโโโโโโโโค                    โ
  โ  6. "Post created!"     โ                       โ                    โ
  โ<โโโโโโโโโโโโโโโโโโโโโโโโโค                       โ                    โ
  โ                         โ                       โ                    โ
```

### Viewing and Revealing a One-Time Post

```
User B              HomeScreen        OneTimePostCard      Backend         MongoDB
  โ                     โ                    โ                โ               โ
  โ  1. Load feed       โ                    โ                โ               โ
  โโโโโโโโโโโโโโโโโโโโโ>โ                    โ                โ               โ
  โ                     โ  2. GET /feed      โ                โ               โ
  โ                     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>โ               โ
  โ                     โ                    โ                โ  3. Query:    โ
  โ                     โ                    โ                โ  $nor: [{     โ
  โ                     โ                    โ                โ    oneTime... โ
  โ                     โ                    โ                โ    viewedBy:  โ
  โ                     โ                    โ                โ    userB_id   โ
  โ                     โ                    โ                โ  }]           โ
  โ                     โ                    โ                โโโโโโโโโโโโโโโ>โ
  โ                     โ                    โ                โ               โ
  โ                     โ  4. Posts (incl.   โ                โ               โ
  โ                     โ     one-time post) โ                โ               โ
  โ                     โ<โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค               โ
  โ                     โ                    โ                โ               โ
  โ  5. See blurred     โ  6. Render         โ                โ               โ
  โ     post            โ  OneTimePostCard   โ                โ               โ
  โ<โโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโ>โ                โ               โ
  โ                     โ                    โ                โ               โ
  โ  7. Tap to reveal   โ                    โ                โ               โ
  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>โ                โ               โ
  โ                     โ                    โ  8. POST       โ               โ
  โ                     โ                    โ  /mark-viewed  โ               โ
  โ                     โ                    โโโโโโโโโโโโโโโโ>โ               โ
  โ                     โ                    โ                โ  9. Update:   โ
  โ                     โ                    โ                โ  $push userId โ
  โ                     โ                    โ                โ  to viewedBy  โ
  โ                     โ                    โ                โโโโโโโโโโโโโโโ>โ
  โ                     โ                    โ                โ               โ
  โ                     โ                    โ  10. Success   โ               โ
  โ                     โ                    โ<โโโโโโโโโโโโโโโโค               โ
  โ  11. Reveal         โ                    โ                โ               โ
  โ     animation       โ                    โ                โ               โ
  โ<โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค                โ               โ
  โ                     โ                    โ                โ               โ
  โ  12. Toast:         โ                    โ                โ               โ
  โ  "Post will         โ                    โ                โ               โ
  โ   disappear..."     โ                    โ                โ               โ
  โ<โโโโโโโโโโโโโโโโโโโโโค                    โ                โ               โ
  โ                     โ                    โ                โ               โ
```

### Post Disappearance After Refresh

```
User B              HomeScreen           Backend              MongoDB
  โ                     โ                    โ                    โ
  โ  1. Pull to refresh โ                    โ                    โ
  โโโโโโโโโโโโโโโโโโโโโ>โ                    โ                    โ
  โ                     โ  2. GET /feed      โ                    โ
  โ                     โโโโโโโโโโโโโโโโโโโโ>โ                    โ
  โ                     โ                    โ  3. Query:         โ
  โ                     โ                    โ  $nor: [{          โ
  โ                     โ                    โ    oneTime.enabled โ
  โ                     โ                    โ    oneTime.viewedByโ
  โ                     โ                    โ    : userB_id      โ
  โ                     โ                    โ  }]                โ
  โ                     โ                    โ  โ Excludes post!  โ
  โ                     โ                    โโโโโโโโโโโโโโโโโโโโ>โ
  โ                     โ                    โ                    โ
  โ                     โ  4. Posts          โ                    โ
  โ                     โ  (without one-time)โ                    โ
  โ                     โ<โโโโโโโโโโโโโโโโโโโโค                    โ
  โ  5. Post is gone!   โ                    โ                    โ
  โ<โโโโโโโโโโโโโโโโโโโโโค                    โ                    โ
  โ                     โ                    โ                    โ
```

## Component Hierarchy

```
HomeScreen
  โโโ FlatList (posts)
      โโโ Post Item
          โโโ Post Header (author info)
          โโโ Post Content
          โ   โโโ IF oneTime.enabled:
          โ   โ   โโโ OneTimePostCard
          โ   โ       โโโ One-Time Badge
          โ   โ       โโโ Blurred Media
          โ   โ       โ   โโโ Reveal Button
          โ   โ       โโโ ParticleNoiseReveal
          โ   โ           โโโ Particle Layer (80 particles)
          โ   โ           โโโ Hint Overlay
          โ   โ           โโโ Hidden Text Layer
          โ   โโโ ELSE:
          โ       โโโ Normal Text
          โ       โโโ Normal Media
          โโโ Post Actions (reactions, comments, etc.)
```

## State Management

```
OneTimePostCard Component State:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ revealed: boolean (false)       โ
โ revealing: boolean (false)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โโ On Mount: revealed = false
         โ
         โโ On Tap: revealing = true
         โ          revealed = true
         โ          API call to mark viewed
         โ
         โโ After API: revealing = false
                      Toast shown
```

## Animation Timeline

```
Reveal Animation (1000ms total):

0ms                                                    1000ms
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                          โ
โ  Blur Opacity:     1.0 โโโโโโโโโโโโโโโโโโโโโโโโโโ> 0.0  โ
โ  Text Opacity:     0.0 โโโโโโโโโโโโโโโโโโโโโโโโโโ> 1.0  โ
โ  Particles:        Jittering โโโโโโโโโโโโโโ> Fade out   โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Particle Jitter (continuous loop until reveal):
โโโโโโโ     โโโโโโโ     โโโโโโโ
โ  โข  โ โโ> โ โข   โ โโ> โ  โข  โ โโ> (repeat)
โโโโโโโ     โโโโโโโ     โโโโโโโ
 200ms       200ms       200ms
```

## Security Flow

```
Client Request                Backend Validation              Database
     โ                              โ                            โ
     โ  POST /mark-viewed           โ                            โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>โ                            โ
     โ                              โ  1. Check auth token       โ
     โ                              โ  2. Verify post exists     โ
     โ                              โ  3. Check oneTime.enabled  โ
     โ                              โ  4. Check not already      โ
     โ                              โ     in viewedBy            โ
     โ                              โ                            โ
     โ                              โ  5. If valid, update       โ
     โ                              โโโโโโโโโโโโโโโโโโโโโโโโโโโโ>โ
     โ                              โ                            โ
     โ  Success                     โ                            โ
     โ<โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค                            โ
     โ                              โ                            โ
```

This architecture ensures:
- โ Secure viewing tracking
- โ Efficient database queries
- โ Smooth user experience
- โ Scalable design
- โ Clean separation of concerns
